// SPDX-FileCopyrightText: 2024 Panoptes Contributors
// SPDX-License-Identifier: MIT
= CLI Reference
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: rouge

Complete reference for all Panoptes CLI commands and options.

== Global Options

These options apply to all commands:

[cols="1,2,1"]
|===
|Option |Description |Default

|`-c, --config <PATH>`
|Path to configuration file
|Auto-detected

|`-v, --verbose`
|Increase verbosity (can be repeated: -v, -vv, -vvv)
|Off

|`-q, --quiet`
|Suppress all output except errors
|Off

|`--json`
|Output in JSON format
|Off

|`-n, --dry-run`
|Show what would be done without making changes
|Off

|`--no-color`
|Disable colored output
|Off

|`-j, --jobs <N>`
|Number of parallel jobs
|CPU count

|`--ollama-url <URL>`
|Ollama API URL
|http://localhost:11434

|`--database <PATH>`
|Database file path
|~/.local/share/panoptes/panoptes.db

|`-h, --help`
|Show help
|

|`-V, --version`
|Show version
|
|===

== Commands

=== scan

Scan and analyze files in a directory.

[source,bash]
----
panoptes scan [OPTIONS] <PATH>
----

==== Arguments

* `<PATH>` - Directory or file to scan

==== Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`-r, --recursive`
|Scan subdirectories
|true

|`--depth <N>`
|Maximum directory depth
|Unlimited

|`--include <GLOB>`
|Include only matching files (can be repeated)
|All supported

|`--exclude <GLOB>`
|Exclude matching files (can be repeated)
|None

|`--min-size <BYTES>`
|Minimum file size
|0

|`--max-size <BYTES>`
|Maximum file size
|Unlimited

|`--skip-analyzed`
|Skip previously analyzed files
|false

|`--force`
|Re-analyze all files
|false

|`--confidence <N>`
|Minimum confidence threshold (0.0-1.0)
|0.5
|===

==== Examples

[source,bash]
----
# Basic scan
panoptes scan ~/Downloads

# Dry run (preview changes)
panoptes scan ~/Pictures --dry-run

# Only images, with depth limit
panoptes scan ~/Photos --include "*.jpg" --include "*.png" --depth 2

# High confidence only
panoptes scan ~/Documents --confidence 0.8

# JSON output for scripting
panoptes scan ~/Downloads --json
----

=== watch

Watch directories for new files and process automatically.

[source,bash]
----
panoptes watch [OPTIONS] <PATH>...
----

==== Arguments

* `<PATH>...` - One or more directories to watch

==== Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`-r, --recursive`
|Watch subdirectories
|true

|`--debounce <MS>`
|Debounce delay in milliseconds
|500

|`--process-existing`
|Process existing files on startup
|false

|`--ignore <GLOB>`
|Ignore matching files
|Hidden, temp files
|===

==== Examples

[source,bash]
----
# Watch Downloads folder
panoptes watch ~/Downloads

# Watch multiple directories
panoptes watch ~/Downloads ~/Desktop

# Process existing files too
panoptes watch ~/Inbox --process-existing
----

=== rename

Rename a file based on AI analysis.

[source,bash]
----
panoptes rename [OPTIONS] <FILE>
----

==== Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--name <NAME>`
|Specify exact name (skip AI)
|AI-generated

|`--prefix <PREFIX>`
|Add prefix to name
|None

|`--suffix <SUFFIX>`
|Add suffix to name
|None

|`--date`
|Include date in filename
|false
|===

=== tag

Manage file tags.

[source,bash]
----
panoptes tag <SUBCOMMAND>
----

==== Subcommands

[source,bash]
----
# Add tags to a file
panoptes tag add <FILE> <TAG>...

# Remove tags from a file
panoptes tag remove <FILE> <TAG>...

# List tags on a file
panoptes tag list <FILE>

# List all tags in database
panoptes tag list-all

# Create a new tag
panoptes tag create <NAME> [--color <HEX>]

# Delete a tag
panoptes tag delete <NAME>
----

=== search

Search files in the database.

[source,bash]
----
panoptes search [OPTIONS] <QUERY>
----

==== Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--tag <TAG>`
|Filter by tag
|None

|`--category <CAT>`
|Filter by category
|None

|`--analyzer <NAME>`
|Filter by analyzer
|None

|`--limit <N>`
|Maximum results
|100
|===

=== history

View operation history.

[source,bash]
----
panoptes history <SUBCOMMAND>
----

==== Subcommands

[source,bash]
----
# List recent operations
panoptes history list [--limit <N>]

# Show details of an operation
panoptes history show <ID>

# Clear history
panoptes history clear [--before <DATE>]

# Export history
panoptes history export <FILE>
----

=== undo

Undo file operations.

[source,bash]
----
panoptes undo [OPTIONS] [ID]
----

==== Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--count <N>`
|Undo last N operations
|1

|`--all`
|Undo all operations
|false
|===

==== Examples

[source,bash]
----
# Undo last operation
panoptes undo

# Undo last 5 operations
panoptes undo --count 5

# Undo specific operation
panoptes undo abc123-def456
----

=== config

Manage configuration.

[source,bash]
----
panoptes config <SUBCOMMAND>
----

==== Subcommands

[source,bash]
----
# Show current configuration
panoptes config show

# Get specific value
panoptes config get <KEY>

# Set a value
panoptes config set <KEY> <VALUE>

# Reset to defaults
panoptes config reset

# Show config file path
panoptes config path

# Validate configuration
panoptes config validate
----

=== db

Database management.

[source,bash]
----
panoptes db <SUBCOMMAND>
----

==== Subcommands

[source,bash]
----
# Show database statistics
panoptes db stats

# Compact database
panoptes db compact

# Export to JSON
panoptes db export <FILE>

# Import from JSON
panoptes db import <FILE>

# Show database path
panoptes db path
----

=== web

Start the web dashboard.

[source,bash]
----
panoptes web [OPTIONS]
----

==== Options

[cols="1,2,1"]
|===
|Option |Description |Default

|`--address <ADDR>`
|Bind address
|127.0.0.1

|`--port <PORT>`
|Port number
|8080

|`--open`
|Open browser automatically
|false
|===

=== shell

Interactive shell and completions.

[source,bash]
----
# Start interactive shell
panoptes shell

# Generate completions
panoptes shell completions <bash|zsh|fish|powershell>
----

=== system

System information and diagnostics.

[source,bash]
----
# Check system status
panoptes system check

# Show system info
panoptes system info

# List supported file types
panoptes system types
----

== Environment Variables

[cols="1,2,1"]
|===
|Variable |Description |Example

|`PANOPTES_OLLAMA_URL`
|Ollama API URL
|http://localhost:11434

|`PANOPTES_MODEL`
|AI model name
|moondream

|`PANOPTES_DATABASE`
|Database path
|/path/to/db.sqlite

|`PANOPTES_MAX_JOBS`
|Parallel jobs
|4

|`PANOPTES_TIMEOUT`
|Request timeout (seconds)
|120

|`PANOPTES_LOG_LEVEL`
|Log level
|info

|`RUST_LOG`
|Rust logging directive
|panoptes=debug
|===

== Exit Codes

[cols="1,2"]
|===
|Code |Meaning

|0
|Success

|1
|General error

|64
|Usage/configuration error

|66
|Input file not found

|69
|Service unavailable (Ollama)

|74
|I/O error

|77
|Permission denied
|===
