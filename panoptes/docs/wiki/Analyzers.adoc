// SPDX-FileCopyrightText: 2024 Panoptes Contributors
// SPDX-License-Identifier: MIT
= File Analyzers
:toc: left
:toclevels: 3
:icons: font
:source-highlighter: rouge

Panoptes includes specialized analyzers for different file types.

== Overview

Each analyzer:

* Handles specific file extensions
* Extracts relevant metadata
* Generates filename suggestions
* Proposes tags and categories
* Reports a confidence score

== Available Analyzers

=== Image Analyzer

Analyzes images using the Moondream vision model.

==== Supported Extensions

`jpg`, `jpeg`, `png`, `gif`, `webp`, `bmp`, `tiff`, `tif`, `ico`, `svg`, `heic`, `heif`, `avif`, `raw`, `cr2`, `nef`, `arw`, `dng`

==== Features

* AI-powered image description
* Intelligent filename generation
* Automatic tagging based on content
* Extracts image dimensions and color info

==== Example

[source]
----
Input:  IMG_2847.jpg
Output: sunset-over-mountain-lake.jpg
Tags:   nature, landscape, sunset, mountains, water
----

=== PDF Analyzer

Analyzes PDF documents by extracting text.

==== Supported Extensions

`pdf`

==== Features

* Text extraction and summarization
* Document type classification
* Automatic categorization
* Word count and metadata

==== Document Categories

* invoice
* report
* letter
* form
* article
* manual
* contract
* other

==== Example

[source]
----
Input:  document(1).pdf
Output: annual-report-2024-acme-corp.pdf
Tags:   report, financial, 2024
----

=== Audio Analyzer

Analyzes audio files using metadata.

==== Supported Extensions

`mp3`, `wav`, `flac`, `ogg`, `m4a`, `aac`, `wma`, `aiff`, `opus`, `webm`

==== Features

* ID3/metadata tag extraction
* Artist/album organization
* Genre-based tagging
* Duration and bitrate info

==== Example

[source]
----
Input:  track01.mp3
Output: the-beatles-hey-jude.mp3
Tags:   rock, the-beatles, 1968
----

=== Video Analyzer

Analyzes video files by cleaning up filenames.

==== Supported Extensions

`mp4`, `mkv`, `avi`, `mov`, `wmv`, `flv`, `webm`, `m4v`, `mpeg`, `mpg`, `3gp`, `ogv`, `ts`, `mts`, `m2ts`

==== Features

* Cleans release group tags
* Removes quality indicators
* Preserves year information
* Detects TV series patterns

==== Example

[source]
----
Input:  Movie.Name.2023.1080p.BluRay.x264-GROUP.mkv
Output: movie-name-2023.mkv
Tags:   video, year:2023
----

=== Code Analyzer

Analyzes source code files.

==== Supported Extensions

`rs`, `py`, `js`, `ts`, `jsx`, `tsx`, `go`, `java`, `c`, `cpp`, `h`, `hpp`, `rb`, `php`, `swift`, `kt`, `scala`, `cs`, `fs`, `ex`, `exs`, `hs`, `ml`, `lua`, `r`, `jl`, and many more.

==== Features

* Language detection
* Code metrics (lines, comments)
* Test file detection
* Main/executable detection

==== Example

[source]
----
Input:  untitled1.py
Output: untitled1.py (name preserved)
Tags:   python, tests, medium
----

=== Document Analyzer

Analyzes office documents and text files.

==== Supported Extensions

`txt`, `text`, `log`, `rtf`, `doc`, `docx`, `odt`, `xls`, `xlsx`, `ods`, `csv`, `ppt`, `pptx`, `odp`, `epub`, `mobi`

==== Features

* Document type detection
* Size categorization
* Text preview extraction
* Word count estimation

==== Example

[source]
----
Input:  notes_final_v2.txt
Output: notes.txt
Tags:   document, text, small
----

=== Archive Analyzer

Analyzes archive files and their contents.

==== Supported Extensions

`zip`, `tar`, `gz`, `tgz`, `bz2`, `xz`, `7z`, `rar`, `iso`, `jar`, `war`, `apk`, `deb`, `rpm`

==== Features

* Content inspection
* File count and compression ratio
* Project type detection
* Top extensions analysis

==== Example

[source]
----
Input:  project-v1.2.3.tar.gz
Output: project-v1.2.3.tar.gz
Tags:   archive, tar.gz, rust-project
----

== Analyzer Priority

When multiple analyzers can handle a file, priority determines which is used:

[cols="1,1"]
|===
|Analyzer |Priority

|Image |80
|PDF |75
|Audio |70
|Video |70
|Code |60
|Document |55
|Archive |50
|===

Higher priority = preferred analyzer.

== Confidence Scores

Each analysis includes a confidence score (0.0-1.0):

[cols="1,2"]
|===
|Range |Interpretation

|0.8-1.0 |High confidence, reliable suggestion
|0.5-0.8 |Moderate confidence, likely accurate
|0.3-0.5 |Low confidence, manual review recommended
|0.0-0.3 |Very low confidence, suggestion may be inaccurate
|===

== Customizing Analyzers

=== Setting Confidence Threshold

Only apply renames above a certain confidence:

[source,bash]
----
panoptes scan --confidence 0.7 ~/Downloads
----

=== Limiting to Specific Types

Process only certain file types:

[source,bash]
----
# Only images
panoptes scan --include "*.jpg" --include "*.png" ~/Photos

# Exclude videos
panoptes scan --exclude "*.mp4" --exclude "*.mkv" ~/Media
----

== Creating Custom Analyzers

Panoptes uses a plugin architecture. To create a custom analyzer:

1. Implement the `FileAnalyzer` trait
2. Register in `AnalyzerRegistry`

[source,rust]
----
use async_trait::async_trait;
use panoptes::{FileAnalyzer, AnalysisResult, Config, Result};
use std::path::Path;

pub struct MyAnalyzer;

#[async_trait]
impl FileAnalyzer for MyAnalyzer {
    fn name(&self) -> &'static str {
        "my-analyzer"
    }

    fn supported_extensions(&self) -> &[&str] {
        &["myext"]
    }

    fn priority(&self) -> u8 {
        60
    }

    async fn analyze(&self, path: &Path, config: &Config) -> Result<AnalysisResult> {
        // Your analysis logic
        Ok(AnalysisResult::new(self.name())
            .with_name("suggested-name")
            .with_confidence(0.8))
    }
}
----
